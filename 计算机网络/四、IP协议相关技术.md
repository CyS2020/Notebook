## IP协议相关技术

### 1. DNS 域名系统协议

-   域名的构成

    ![域名分层结构](https://github.com/CyS2020/Notebook/raw/master/%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/%E5%9F%9F%E5%90%8D%E7%9A%84%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84.jpg)

    主机名. 次级域名. 顶级域名. 根域名

      www.     baidu.       com.       root

-   域名服务器：根部所设置的DNS叫做根域名服务器，根域名服务器中注册着根（root）以下第一层域名服务器的IP地址（.com, .edu, .hk, .cn等)。下一层的域名服务器中注册着再往下一层的域名服务器的IP地址，如果没有往下的其他分层，就可以自由地指定主机名称或子网名称

-   域名解析器：进行DNS查询的主机和软件叫做DNS解析器

    ![DNS查询过程](https://github.com/CyS2020/Notebook/raw/master/%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/DNS%E6%9F%A5%E8%AF%A2%E8%BF%87%E7%A8%8B.png)

### 2. ARP 地址解析协议

-   ARP概要：以目标IP地址为线索，来定位下一个应该接收数据分包的网络设备对应的MAC地址。如果目标主机不在同一个链路上，可以通过ARP查找下一条路由的的MAC地址。不过ARP只适用于IPv4

-   工作机制：起初要通过广播发送一个ARP请求包，这个包中包含了想要了解其MAC地址的主机IP地址，由于广播包会被这同一个链路上的所有的主机和路由器进行解析，如果ARP请求包中的目标IP地址与自己的IP地址一致，那么这个节点就将自己的MAC地址塞入ARP响应包返回给主机A。如果每发送一个IP数据报就进行一次ARP请求会造成不必要的浪费，通常做法把获取到的MAC地址缓存一段时间，定期更新

-   ARP包格式：

    ![ARP包格式](https://github.com/CyS2020/Notebook/raw/master/%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/ARP%E5%8C%85%E6%A0%BC%E5%BC%8F.jpg)

-   RARP：**逆地址解析协议**，从MAC地址定位IP地址的一种协议。有些设备没有任何输入接口或无法通过DHCP自动分配获取IP地址的情况，就可以使用RARP，先架设一台RARP的服务器，从而在这个服务器上注册设备的MAC地址及IP地址，然后插电启动设备时，进行请求响应操作如图。

    ![RARP操作](https://github.com/CyS2020/Notebook/raw/master/%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/RARP%E6%93%8D%E4%BD%9C.jpg)

### 3. ICMP 互联网控制消息协议

-   架构IP网络时需要特别注意两点：确认网络是否正常工作，以及遇到异常时进行问题诊断。ICMP正是提供这类功能的协议，主要功能包括确认IP包是否成功送达目标地址，通知发送过程当中IP包被废弃的具体原因，改善网络设置等。ICMP消息可以分为两类：一类是通知出错原因的错误消息，一类是用于诊断的查询消息。

    ![ICMP无法到达的消息]()

-   主要的ICMP消息：ICMP目标不可达消息（**类型3**），ICMP重定向消息（**类型5**），ICMP超时消息（**类型11**），ICMP回送消息（**类型0， 8**），ICMP源点抑制消息（**类型4**），ICMP路由器探索消息（**类型9， 10**），ICMP地址掩码消息（**类型17， 18**）。

### 4. DHCP 动态主机配置协议

-   逐一为每一台主机设置IP地址会非常繁琐，为了实现自动设置IP地址、统一管理IP地址分配，就产生了DHCP协议，有了DHCP计算机只要连接到网络就可以进行TCP/IP通信。也就是说让DHCP让即插即用变得可能。

-   使用DHCP之前，首先要架设一台DHCP服务器。然后将DHCP所要分配的IP地址设置到服务器上，要需要将相应的子网掩码、路由控制信息以及DNS服务器的地址设置到服务器上。

-   DHCP的工作原理，分为四个阶段。**发现阶段**：发送DHCP发现包客户端寻找服务器，因为DHCP服务器的IP地址对于客户机来说是未知的，所以DHCP客户机以广播的方式发送DHCP-DISCOVER信息寻找DHCP服务器，目标地址255.255.255.255，源地址0.0.0.0表示未知。**提供阶段**：在网络中接收到DHCP-DISCOVER信息的服务器做出响应，从尚未分配的IP地址中挑选一个分配给DHCP客户端，DHCP发送一个包含分配的IP地址和其他设置的DHCP-OFFER信息。**选择阶段**：如果有都台服务器，DHCP客户端只接受第一个收到的DHCP-OFFER信息，然后以广播方式回答一个DHCP-REQUEST信息，该信息包含了它所接受的DHCP服务器分配的IP地址的内容。**确认阶段**：即DHCP服务器确认所提供的IP地址的阶段。当DHCP服务器收到DHCP客户端回答的DHCP-REQUEST信息之后，它便向DHCP客户端发送一个包含它所提供的IP地址和其他设置的DHCP-ACK信息，告诉DHCP客户端可以使用它所提供的IP地址。DHCP客户端将获取到的IP地址与网卡绑定。

    ![DHCP工作原理]()

-   DHCP中继代理：多个以太网（无线LAN）的网段，这种情况下，若要针对每个网段设置DHCP服务器是一个庞大的工程。因此在这类环境中往往需要一个中继代理来实现统一管理，对不同网段的IP地址的分配可以由一个DHCP服务器统一管理运维。DHCP客户端会向DHCP中继代理发送DHCP请求包，而DHCP中继代理在收到这个广播包以后会以单播的形式发送给DHCP服务器。服务器端收到该包以后再向DHCP中继代理返回应答，并由DHCP中继代理将此包转发给DHCP客户端。

    ![DHCP中继代理]()