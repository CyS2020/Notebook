### 分布式基础
1. 简述CAP理论
- 数据一致性(consistency)：数据写操作返回成功，那么之后的读请求都必须读到这个新数据；
如果返回失败，那么所有读操作都不能读到这个数据，对于调用者而言数据具有强一致性
- 服务可用性(availability)：所有读写请求在一定时间内得到相应，可终止，不会一直等待
- 分区容错性(partition-tolerance)：网络分区的情况下，被分隔的节点仍然能正常对外服务
注释：在分布式中 CA 是无法兼得的，分布式架构中要么 CP，要么 AP

2. 简述Base理论
- 基本可用：允许可用性降低（可能响应延长，可能服务降级）
- 软状态：指允许系统中的数据存在中间状态，并认为该中间状态不会影响系统整体可用性
- 最终一致性：节点数据同步可以存在时延，但在一定的期限后必须达成数据的一致，状态变为最终状态
注释：cap理论的一种妥协，由于cap只能二取其一，base理论降低了发生分区容错时对可用性和一致性的要求

3. 数据一致性模型有哪些
- 最终一致性：是弱一致性的特例，不一致窗口的时间主要受通信延迟，系统负载和复制副本的个数影响
- 因果一致性：要求有因果关系的操作顺序得到保证，非因果关系的操作顺序则无所谓
- 会话一致性：将对系统数据的访问过程框定在一个会话当中，约定了系统能在同一个有效的会话中实现
读己之所写的一致性
- 单调读一致性：后读到的不能比先读到的数据版本更旧
- 单调写一致性：后写一定要在先写成功的基础之上，也包含这因果一致性
- 读写一致性：自己写进去的自己也得能读出来

4. 选举算法Quorum、WARO机制
- WARO：一直能够简单副本控制协议，写操作时，只有当所有的副本都更新成功之后，写操作才算成功
- Quorum：10个副本，一次成功更新了三个，就算写操作成功，那么读则需要至少读八个副本的数据

5. paxos算法思想 - 共识算法
- 解决的是分布式系统如何就某个（决议）达成一致
- 阶段一 prepare：Proposer受到client请求，或者发现有未提交的值，选择提案编号N，想半数以上的Acceptor发送请求
- 阶段二 accept：如果Proposer（提案者）受到半数以上Acceptor（接收者）对齐发出的编号为N的Prepare响应
那么会发送一个针对[N, V]的提案，Acceptor比较N如果发来的N大则交给leaner（记录员），达成一致

6. raft算法
- leader、follower、candidate; leader负责接收客户端写请求，然后复制到follower节点，并在安全的时候执行这些请求
- 触发选举：集群初始化时，都是follower，随机超时变成candidate，发起选举；一定的时间内没有收到来自leader心跳，发起选举
- term 任期：leader产生到重新选举为一任期，每个节点都维持当前的任期号，避免出现脑裂的情况，出现两个leader
- rpc通信：RequestVote RPC：负责选举，包含lastIndex, lastTerm；AppendEntries RPC：负责数据交互
- 日志序列：每个节点上维持着一份持久化Log，通过一致性协议算法，保证每个节点中的log保持一致，且顺序存放
- 状态机：日志序列同步到多数节点时，leader将该日志提交到状态机，并在下一次心跳通知所有节点提交状态机，携带最后提交lastIndex
- 选举过程：
1. 增加本地的term，切换到candidate状态，投自己一票
2. 并行给其他节点发送 RequestVote RPCs(拉票请求)，包含term参数
3. 等待回复，收到大多数投票，赢得选举，切换到leader状态，给所有节点发送心跳消息；被告知别人当选，自己切换成follower状态
- 日志序列同步：客户端发送命令给leader，leader把日志条目追加到日志序列里；发送AppendEntries RPC请求给所有follower
根据日志序列prevLogIndex, prevLogTerm匹配，若匹配上则追加到自己的日志序列，匹配不上则调小index直到匹配上；日志序列
条目同步到大多数节点的时候，日志序列应用到状态机中，每一个节点拥有一个状态机；
- 新选举出的leader一定拥有的所有已提交的状态机的日志条目
- 安全原则：选举安全原则；状态机安全原则；领导人完全原则；领导人只附加原则；日志匹配原则

7. 简述zab协议 （zookeeper)
- 为分布式协调服务Zookeeper专门设计的支持崩溃恢复的原子广播协议，实现分布式数据一致性
- zab协议包括两种基本模式：崩溃恢复和消息广播
- 消息广播：集群中所有的写事务请求都由leader节点来处理，其他服务器为follower，leader将写事务请求转换为事务Proposal，并将Proposal
分发给集群中其他所有follower，完成后等待follower反馈超过半数后，leader再次向集群内follower广播commit信息确认Proposal提交
- 崩溃恢复：初始化集群的时候，leader崩溃的时候，leader失去了半数机器的支持
开启新一轮的leader选举，选举产生的leader会与过半的follower进行同步，使数据一致，当与过半的机器同步完成后，就退出恢复模式，进入消息广播模式
- 选举过程：
将自己的投票信息广播出去，收到的节点进行pk--根据Zxid与serverId，然后更新自己的投票信息

8. 负载均衡策略
- 轮询法、加权轮询法、随机法、加权随机法、源地址哈希法、最小连接法

9. 集群、分布式、SOA、微服务概念及区别
- 集群节点之间功能对等的对外提供服务，分布式节点之间协调的对外提供服务
- SOA中心化思想服务之间调用基于ESB(企业服务总线)，微服务彻底组件化服务化应用之间通过服务完成交互和集成

10. 分布式系统设计目标
- 可扩展性、高可用、无状态、可管理、高可靠

11. 分布式事务有那些解决方案
- 基于XA协议：两阶段、三阶段提交，需要数据库层面的支持
- 基于事务补偿机制：TCC，基于业务层面实现
- 本地消息表：基于本地数据库+mq
- 基于事务消息：基于消息中间件mq